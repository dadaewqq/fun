!function(n){"use strict";window.Audio&&function(){for(var o=n.AudioTag={api:"audiotag"},t={},i=127,e=-1,u=[],f=[],r={},c=0;c<12;c++)u[c]=new Audio;var a=function(o,t){if(n.channels[o]){var c=n.channels[o].instrument,a=n.GM.byId[c].id;if(t=r[t]){var s=a+""+t.id,d=(e+1)%u.length,l=u[d];if(f[d]=s,!n.Soundfont[a])return void n.DEBUG;l.src=n.Soundfont[a][t.id],l.volume=i/127,l.play(),e=d}}},s=function(o,t){if(n.channels[o]){var i=n.channels[o].instrument,c=n.GM.byId[i].id;if(t=r[t])for(var a=c+""+t.id,s=0,d=u.length;s<d;s++){var l=(s+e+1)%d,v=f[l];if(v&&v==a)return u[l].pause(),void(f[l]=null)}}};o.audioBuffers=u,o.send=function(n,o){},o.setController=function(n,o,t,i){},o.setVolume=function(n,o){i=o},o.programChange=function(o,t){n.channels[o].instrument=t},o.pitchBend=function(n,o,t){},o.noteOn=function(n,o,i,e){var u=t[o];if(r[u])return e?setTimeout(function(){a(n,u)},1e3*e):void a(n,u)},o.noteOff=function(n,o,t){},o.chordOn=function(n,o,i,e){for(var u=0;u<o.length;u++){var f=o[u],c=t[f];if(r[c]){if(e)return setTimeout(function(){a(n,c)},1e3*e);a(n,c)}}},o.chordOff=function(n,o,i){for(var e=0;e<o.length;e++){var u=o[e],f=t[u];if(r[f]){if(i)return setTimeout(function(){s(n,f)},1e3*i);s(n,f)}}},o.stopAllNotes=function(){for(var n=0,o=u.length;n<o;n++)u[n].pause()},o.connect=function(i){for(var e in n.setDefaultPlugin(o),n.keyToNote)t[n.keyToNote[e]]=e,r[e]={id:e};i.onsuccess&&i.onsuccess()}}()}(MIDI);